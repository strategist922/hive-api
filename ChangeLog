Complete rewrite of the api from version 0 to 1

